var T=Object.defineProperty;var d=(n=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(n,{get:(e,o)=>(typeof require<"u"?require:e)[o]}):n)(function(n){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+n+'" is not supported')});var N=(n,e)=>{for(var o in e)T(n,o,{get:e[o],enumerable:!0})};import tn from"cac";import{resolve as p}from"path";import{writeFileSync as E,existsSync as F,mkdirSync as rn}from"fs";import{resolve as $,extname as R}from"path";import{readdirSync as H,statSync as C,readFileSync as K,writeFileSync as V}from"fs";import z from"magic-string";var k=0;function A(){return++k,`${global.i18n.config.prefix}${k}`}var g={},w=n=>{let e=H(n);e=e.filter(o=>!global.i18n.config.ignoreDirs.includes(o)),e.forEach(o=>{let r=$(n,o);if(C(r).isDirectory())w($(n,o));else{let c=K(r,"utf-8");if(global.i18n.config.ignoreExts.includes(R(r||"")))return;let i=new z(c);i.replace(global.i18n.config.reg,(...s)=>{let l=A();return g=global.i18n.config.handlerResult(g,l,s),global.i18n.back?global.i18n.config.backHandler(g,l,s):global.i18n.config.handlerTemlpate(g,l,s)}),V(r,i.toString())}})};function D(n){return w(n),g}import I from"md5";import M from"axios";var j=n=>(n=n.reduce((e,o)=>{if(e.length>0){let r=e.pop();return r.length<20?[...e,[...r,o]]:[...e,r,[o]]}return[...e,[o]]},[]),n),_=async(n,e,o)=>{try{let r=Object.values(n),a=Object.keys(n),c=j(r),i=j(a),s=c.map(t=>t.join(`
`)),l=[];for(let t=0;t<s.length;t++){let f=s[t],y=new Date().getTime(),v=global.i18n.config.appid+f+y+global.i18n.config.key,J=I(v),u=(await M.get("http://api.fanyi.baidu.com/api/trans/vip/translate",{params:{q:f,appid:global.i18n.config.appid,salt:y,from:e,to:o,sign:J}})).data;if(u&&u.error_code)throw new Error(u.error_code);l=[...l,...u.trans_result.map((x,S)=>{if(!i[t]||!i[t][S])throw new Error(JSON.stringify(x));return{key:i[t][S],item:x}})]}return l.reduce((t,f)=>({...t,[f.key]:f.item.dst}),{})}catch(r){console.log(r)}};var b={};N(b,{appid:()=>L,backHandler:()=>on,from:()=>Q,getCacheFromJson:()=>q,handlerResult:()=>nn,handlerTemlpate:()=>en,ignoreDirs:()=>W,ignoreExts:()=>X,key:()=>P,prefix:()=>Z,reg:()=>Y,to:()=>U});var B=d("fs"),G=d("path"),L="",P="",Q="cht",U=["en","zh"],W=[".hbuilderx","node_modules","uni_modules","unpackage",".git","dist","static"],X=[".woff2",".jpg",".png",".pdf",".keystore"],Y=new RegExp(/\$t\(('|"|`)(.*?)('|"|`)\)/g),Z="i18n_",nn=(n,e,[o,r,a,c])=>(n[e]=a,n),en=(n,e,[o,r,a,c])=>`$t(${r}${e}${c})`,m,q=()=>{if(m)return m;let n=B.readFileSync(G.resolve(global.i18n.cacheDir,`./${global.i18n.cacheDir}.json`),"utf-8");return m=JSON.parse(n),m},on=(n,e,[o,r,a,c])=>{let i=q();return`$t(${r}${i[e]?i[e]:""}${c})`};global.i18n={};global.i18n.config=b;async function O(){let n=process.cwd();if(global.i18n.cacheDir=p(n,".i18n"),F(p(global.i18n.cacheDir,"config.js"))){let o=d(p(global.i18n.cacheDir,"config.js"));global.i18n.config=o}F(global.i18n.cacheDir)||rn(global.i18n.cacheDir);let e=D(n);global.i18n.back||(E(p(global.i18n.cacheDir,`${global.i18n.config.from}.json`),JSON.stringify(e,null,2)),global.i18n.config.to.forEach(async o=>{let r=await _(e,global.i18n.config.from,o);E(p(global.i18n.cacheDir,`${o}.json`),JSON.stringify(r,null,2))}))}var h=tn();h.command("i18n","\u63D0\u53D6\u5F53\u524D\u9879\u76EE\u4E0B\u591A\u8BED\u8A00\u7684\u6587\u672C\uFF0C \u8FDB\u884C\u5904\u7406\u5E76\u7FFB\u8BD1").option("back","\u56DE\u9000\u4EE3\u7801").action(async({back:n})=>{global.i18n.back=n,O()});h.help();h.parse();
//# sourceMappingURL=index.mjs.map