var C=Object.create;var S=Object.defineProperty;var V=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames;var A=Object.getPrototypeOf,I=Object.prototype.hasOwnProperty;var M=(e,n)=>{for(var o in n)S(e,o,{get:n[o],enumerable:!0})},B=(e,n,o,t)=>{if(n&&typeof n=="object"||typeof n=="function")for(let a of z(n))!I.call(e,a)&&a!==o&&S(e,a,{get:()=>n[a],enumerable:!(t=V(n,a))||t.enumerable});return e};var x=(e,n,o)=>(o=e!=null?C(A(e)):{},B(n||!e||!e.__esModule?S(o,"default",{value:e,enumerable:!0}):o,e));var H=x(require("cac"));var u=require("path"),p=require("fs");var y=require("path"),b=require("fs"),T=x(require("magic-string")),w=0;function G(){return++w,`${global.i18n.config.prefix}${w}`}var h={},N=e=>{let n=(0,b.readdirSync)(e);n=n.filter(o=>!global.i18n.config.ignoreDirs.includes(o)),n.forEach(o=>{let t=(0,y.resolve)(e,o);if((0,b.statSync)(t).isDirectory())N((0,y.resolve)(e,o));else{let g=(0,b.readFileSync)(t,"utf-8");if(global.i18n.config.ignoreExts.includes((0,y.extname)(t||"")))return;let r=new T.default(g);r.replace(global.i18n.config.reg,(...l)=>{let i=G();return h=global.i18n.config.handlerResult(h,i,l),global.i18n.back?global.i18n.config.backHandler(h,i,l):global.i18n.config.handlerTemlpate(h,i,l)}),(0,b.writeFileSync)(t,r.toString())}})};function _(e){return N(e),h}var J=x(require("md5")),F=x(require("axios")),q=e=>(e=e.reduce((n,o)=>{if(n.length>0){let t=n.pop();return t.length<20?[...n,[...t,o]]:[...n,t,[o]]}return[...n,[o]]},[]),e),E=async(e,n,o)=>{try{let t=Object.values(e),a=Object.keys(e),g=q(t),r=q(a),l=g.map(c=>c.join(`
`)),i=[];for(let c=0;c<l.length;c++){let s=l[c],f=new Date().getTime(),m=global.i18n.config.appid+s+f+global.i18n.config.key,K=(0,J.default)(m),d=(await F.default.get("http://api.fanyi.baidu.com/api/trans/vip/translate",{params:{q:s,appid:global.i18n.config.appid,salt:f,from:n,to:o,sign:K}})).data;if(d&&d.error_code)throw console.log("\u7FFB\u8BD1\u5931\u8D25\uFF1A",d),new Error(d.error_code);i=[...i,...d.trans_result.map((D,O)=>{if(!r[c]||!r[c][O])throw new Error(JSON.stringify(D));return{key:r[c][O],item:D}})]}return i.reduce((c,s)=>({...c,[s.key]:s.item.dst}),{})}catch(t){console.log(t)}};var j={};M(j,{appid:()=>Q,backHandler:()=>re,from:()=>W,getCacheFromJson:()=>v,handlerResult:()=>oe,handlerTemlpate:()=>te,ignoreDirs:()=>Y,ignoreExts:()=>Z,key:()=>U,prefix:()=>ne,reg:()=>ee,to:()=>X});var L=require("fs"),P=require("path"),Q="",U="",W="cht",X=["en","zh"],Y=[".hbuilderx","node_modules","uni_modules","unpackage",".git","dist","static"],Z=[".woff2",".jpg",".png",".pdf",".keystore"],ee=new RegExp(/\$t\(('|"|`)(.*?)('|"|`)\)/g),ne="i18n_",oe=(e,n,[o,t,a,g])=>(e[n]=a,e),te=(e,n,[o,t,a,g])=>`$t(${t}${n}${g})`,k,v=()=>{if(k)return k;let e=L.readFileSync(P.resolve(global.i18n.cacheDir,`./${global.i18n.cacheDir}.json`),"utf-8");return k=JSON.parse(e),k},re=(e,n,[o,t,a,g])=>{let r=v();return`$t(${t}${r[n]?r[n]:""}${g})`};global.i18n={};global.i18n.config=j;async function R(){let e=process.cwd();if(global.i18n.cacheDir=(0,u.resolve)(e,".i18n"),(0,p.existsSync)((0,u.resolve)(global.i18n.cacheDir,"config.js"))){let r=require((0,u.resolve)(global.i18n.cacheDir,"config.js"));global.i18n.config=r}(0,p.existsSync)(global.i18n.cacheDir)||(0,p.mkdirSync)(global.i18n.cacheDir);let n=_(e);if(global.i18n.back)return;(0,p.writeFileSync)((0,u.resolve)(global.i18n.cacheDir,`${global.i18n.config.from}.json`),JSON.stringify(n,null,2));let o={},t={};(0,p.existsSync)((0,u.resolve)(global.i18n.cacheDir,"cache.json"))&&(t=require((0,u.resolve)(global.i18n.cacheDir,"cache.json"))),o[global.i18n.config.from]=n;for(let r of global.i18n.config.to){let l=[],i=JSON.parse(JSON.stringify(n));if(t){let s=Object.keys(t);i=Object.keys(i).reduce((f,m)=>!s.includes(i[m])||!t[i[m]][r]?{...f,[m]:i[m]}:(l[m]=t[i[m]][r],f),{})}console.log(i,"\u7FFB\u8BD1\u6570\u636E",r);let c=await E(i,global.i18n.config.from,r);l={...l,...c},l=Object.keys(l).sort((s,f)=>Number(s.replace(global.i18n.config.prefix,""))-Number(f.replace(global.i18n.config.prefix,""))).reduce((s,f)=>({...s,[f]:l[f]}),{}),(0,p.writeFileSync)((0,u.resolve)(global.i18n.cacheDir,`${r}.json`),JSON.stringify(l,null,2)),o[r]=c}let a=Object.keys(o),g=Object.keys(o[global.i18n.config.from]).reduce((r,l)=>{let i=o[global.i18n.config.from][l],c=a.reduce((s,f)=>o[f][l]?{...s,[f]:o[f][l]}:s,{});return r[i]?r[i]={...r[i],...c}:r[i]=c,r},t);(0,p.writeFileSync)((0,u.resolve)(global.i18n.cacheDir,"cache.json"),JSON.stringify(g,null,2))}var $=(0,H.default)();$.command("i18n","\u63D0\u53D6\u5F53\u524D\u9879\u76EE\u4E0B\u591A\u8BED\u8A00\u7684\u6587\u672C\uFF0C \u8FDB\u884C\u5904\u7406\u5E76\u7FFB\u8BD1").option("back","\u56DE\u9000\u4EE3\u7801").action(async({back:e})=>{global.i18n.back=e,R()});$.help();$.parse();
//# sourceMappingURL=index.js.map